
# Fix messed up keybindings
set-option -g xterm-keys on

# Set a safe default terminal inside tmux
set -g default-terminal "tmux-256color"

# Enable 256-color mode (truecolor) in general
set -g terminal-overrides '*:Tc'

# Enable 256-color mode specifically for Ghostty terminal
set -ga terminal-overrides ",ghostty*:Tc"

# Add support for underline styles (Smulx) and underline colors (Setulc)
set -ga terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -ga terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# RGB overrides for terminals
# set -ag terminal-overrides ",xterm-ghostty:RGB"
# set -ag terminal-overrides ",xterm-kitty:RGB"
# set -ag terminal-overrides ",xterm-256color:RGB"

# Allow passthrough for Kitty graphics
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# Stop rename of terminal window title when assigigned title
# set-option -g allow-rename off
# set-option -g automatic-rename off

unbind C-b
set -g prefix C-Space
# bind C-Space send-prefix

# Reload tmux config with Ctrl+Space
unbind r
bind r source-file ~/.tmux.conf \; display-message "tmux config reloaded!"

# Vim style pane selection
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

# Resize panes with Ctrl+Arrow
bind Up    resize-pane -U 5
bind Down  resize-pane -D 5
bind Left  resize-pane -L 5
bind Right resize-pane -R 5

# Support for Ghostty Cmd+Shift+H/L sending prefix+H/L
bind C-H previous-window
bind C-L next-window

# ------------------------------
# Split panes like Vim
# ------------------------------
bind | split-window -h
bind - split-window -v


set -g base-index 1              # start indexing windows at 1 instead of 0
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g escape-time 0             # zero-out escape time delay
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-position top       # macOS / darwin style
# set -g default-terminal "${TERM}"
setw -g mode-keys vi

set -g @fzf-url-fzf-options '-p 60%,30% --prompt="ÔÇé   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'catppuccin/tmux#v2.1.3' 
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-dir '~/.tmux/resurrect'


run '~/.tmux/plugins/tmux-cpu/cpu.tmux'
run '~/.tmux/plugins/catppuccin-tmux/catppuccin.tmux'
# ----------------------
# Pane Styling
# ----------------------
# set -g @catppuccin_pane_left_separator " ÓÇ∂"
# set -g @catppuccin_pane_middle_separator "‚ñà"
# set -g @catppuccin_pane_right_separator "ÓÇ¥ "

set -agF status-right "#{E:@catppuccin_status_cpu}"
# ----------------------
# Window Styling
# ----------------------
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_current_text_color "#W#{?window_zoomed_flag,(ÓÆÅ),}"
set -g @catppuccin_window_flags "icon"
# set -g @catppuccin_window_left_separator " ÓÇ∂"
# set -g @catppuccin_window_right_separator "ÓÇ¥"
# set -g @catppuccin_window_middle_separator " ‚ñà"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_text " #{window_name}"
# set -g @catppuccin_window_current_text "#{window_name}"
# Add padding between numbers/text
set -g window-status-separator "  "
# ----------------------
# Status Line
# ----------------------
 set -g @catppuccin_status_left_separator " ÓÇ∂"
 set -g @catppuccin_status_middle_separator "‚ñà"
 set -g @catppuccin_status_right_separator "ÓÇ¥ "
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_module_bg_color "#{@thm_surface_0}"
set -g @catppuccin_status_modules_right "directory cpu date_time"
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_date_time_text "%H:%M"
set -g @catppuccin_directory_text "#{b:pane_current_path}"

##### Display Help #####-

bind ? new-window -n "Help" "cat <<'EOF'
===========================================================
                       T M U X   H E L P
===========================================================

üìÇ Windows
-----------------------------------------------------------
Ctrl+Space + c         ‚Üí Create new window
Ctrl+Space + &         ‚Üí Kill current window
Ctrl+Space + H / L     ‚Üí Previous / Next window
Ctrl+Space + 1..9      ‚Üí Jump directly to window (1‚Äì9)
Ctrl+Space + ,         ‚Üí Rename current window

ü™ü Panes
-----------------------------------------------------------
Ctrl+Space + %         ‚Üí Split pane vertically
Ctrl+Space + \"         ‚Üí Split pane horizontally
Ctrl+Space + x         ‚Üí Kill current pane
Ctrl+Space + h/j/k/l   ‚Üí Move left / down / up / right
Ctrl+Space + ‚Üë/‚Üì/‚Üê/‚Üí   ‚Üí Resize pane
Ctrl+Space + z         ‚Üí Zoom in/out toggle current pane
Ctrl+Space + [ or ]    -> scroll

üìú Session
-----------------------------------------------------------
Ctrl+Space + d         ‚Üí Detach session
tmux ls                ‚Üí List sessions
tmux attach -t <name>  ‚Üí Attach to session
tmux new -s <name>     ‚Üí Create new session

üîç Misc
-----------------------------------------------------------
Ctrl+Space + ?         ‚Üí Show this help
Ctrl+Space + r         ‚Üí Reload tmux config (~/.tmux.conf)
===========================================================
Press ENTER to close help...
===========================================================
EOF
read"


run '~/.tmux/plugins/tmux-continuum/continuum.tmux' 
run '~/.tmux/plugins/tmux-resurrect/resurrect.tmux'
run '~/.tmux/plugins/tpm/tpm'

set -g status-bg default
set -g status-style bg=default

